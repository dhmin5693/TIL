# 변경 가능성을 최소화하라

## 불변 클래스

- 불변 클래스는 인스턴스 필드를 수정할 수 없는 클래스를 말한다.
- 불변 클래스는 생성 시 필드가 고정되고 파괴되는 순간까지 절대 변하지 않는다.
- 자바에서 제공하는 `String` , `BigInteger` , `BigDecimal` 은 불변이다.

## 불변 클래스의 규칙

- 객체의 상태를 변경하는 메소드를 제공하지 않는다.
- 클래스를 확장할 수 없도록 한다.
- 모든 필드는 final로 선언한다.
- 모든 필드의 접근 제한자는 private이다.
- 다른 클래스에서는 내부의 가변 필드에 절대 접근할 수 없도록 한다.

## 불변 클래스의 장점

- 단순하게 사용할 수 있다.
- 불변은 가변보다 설계 및 구현, 사용이 쉬우며 안전하기 때문에 오류를 줄일 수 있다.
- 근본적으로 thread-safe 하다.
- 원자성을 갖는다.
    - 특정 메소드에서 예외가 발생하더라도 메소드 호출 전과 같은 상태를 유지한다.

## 불변 클래스의 단점

- 값이 다르면 다른 객체를 생성해야 한다.
    - 값이 아주 많은 경우엔 비용이 아주 커질 수 있다.
    - `BigDecimal` 와 같은 불변 클래스는 두 개의 값을 더해야 할 때 새로운 인스턴스를 생성한다.
    - 다단계 연산에서 매우 불리할 수 있다.
    - 생성자를 private으로 막고 팩토리 메소드에서 캐싱 기능을 제공하면 이 단점을 약간 해소할 수 있다.

## 정리

- 불변 클래스는 오류를 크게 줄일 수 있는 좋은 설계이다.
- 모든 필드를 불변으로 사용할 수 없다면 불변인 부분을 최대한으로 늘린다.
- 필드는 가급적 private final로 선언한다.
- 불변 클래스는 생성자가 종료되는 순간 모든 필드의 초기화를 완벽하게 수행해야 한다.
